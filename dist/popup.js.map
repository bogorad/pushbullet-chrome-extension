{
  "version": 3,
  "sources": ["../src/types/domain.ts", "../src/lib/ui/dom.ts", "../src/infrastructure/storage/storage.repository.ts", "../src/popup/index.ts"],
  "sourcesContent": ["/************************************\r\n * Domain types for TypeScript plan *\r\n ************************************/\r\n\r\nexport type ISO8601 = string;\r\n\r\n// ============================================================================\r\n// User and Device Types\r\n// ============================================================================\r\n\r\nexport interface User {\r\n  iden: string;\r\n  email?: string;\r\n  name?: string;\r\n  image_url?: string;\r\n  max_upload_size?: number;\r\n}\r\n\r\nexport interface Device {\r\n  iden: string;\r\n  nickname?: string;\r\n  manufacturer?: string;\r\n  model?: string;\r\n  active?: boolean;\r\n  created?: number;\r\n  modified?: number;\r\n  push_token?: string;\r\n  app_version?: number;\r\n  type?: string;\r\n  kind?: string;\r\n  icon?: string;\r\n  has_sms?: boolean;\r\n}\r\n\r\n// ============================================================================\r\n// Push Types\r\n// ============================================================================\r\n\r\nexport interface PushBase {\r\n  iden?: string;\r\n  active?: boolean;\r\n  created?: number;\r\n  modified?: number;\r\n  dismissed?: boolean;\r\n  direction?: 'self' | 'incoming' | 'outgoing';\r\n  sender_iden?: string;\r\n  sender_email?: string;\r\n  sender_name?: string;\r\n  receiver_iden?: string;\r\n  receiver_email?: string;\r\n  target_device_iden?: string;\r\n  source_device_iden?: string;\r\n  encrypted?: boolean;\r\n  ciphertext?: string;\r\n}\r\n\r\nexport interface LinkPush extends PushBase {\r\n  type: 'link';\r\n  title?: string;\r\n  body?: string;\r\n  url: string;\r\n}\r\n\r\nexport interface NotePush extends PushBase {\r\n  type: 'note';\r\n  title?: string;\r\n  body?: string;\r\n}\r\n\r\nexport interface FilePush extends PushBase {\r\n  type: 'file';\r\n  file_name?: string;\r\n  file_type?: string;\r\n  file_url?: string;\r\n  body?: string;\r\n  image_url?: string;\r\n  image_width?: number;\r\n  image_height?: number;\r\n}\r\n\r\nexport interface MirrorPush extends PushBase {\r\n  type: 'mirror';\r\n  title?: string;\r\n  body?: string;\r\n  icon?: string;\r\n  application_name?: string;\r\n  package_name?: string;\r\n  notification_id?: string;\r\n  notification_tag?: string;\r\n  source_user_iden?: string;\r\n}\r\n\r\nexport interface DismissalPush extends PushBase {\r\n  type: 'dismissal';\r\n  package_name?: string;\r\n  notification_id?: string;\r\n  notification_tag?: string;\r\n  source_user_iden?: string;\r\n}\r\n\r\nexport interface SmsChangedPush extends PushBase {\r\n  type: 'sms_changed';\r\n  notifications?: Array<{\r\n    title?: string;\r\n    body?: string;\r\n    timestamp?: number;\r\n    image_url?: string;\r\n  }>;\r\n}\r\n\r\nexport type Push = LinkPush | NotePush | FilePush | MirrorPush | DismissalPush | SmsChangedPush;\r\n\r\n// ============================================================================\r\n// Chat Types\r\n// ============================================================================\r\n\r\n/**\r\n * Represents a chat/conversation with a contact\r\n * From /v2/chats API endpoint\r\n */\r\nexport interface Chat {\r\n  iden: string;\r\n  active: boolean;\r\n  created: number;\r\n  modified: number;\r\n  muted?: boolean;\r\n  with: {\r\n    email: string;\r\n    email_normalized: string;\r\n    iden?: string;\r\n    image_url?: string;\r\n    name?: string;\r\n    type: \"user\" | \"email\";\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// Session and State Types\r\n// ============================================================================\r\n\r\nexport interface SessionCache {\r\n  userInfo: User | null;\r\n  devices: Device[];\r\n  recentPushes: Push[];\r\n  chats: Chat[]; // \u2190 ADD THIS LINE\r\n  isAuthenticated: boolean;\r\n  lastUpdated: number;\r\n  autoOpenLinks: boolean;\r\n  deviceNickname: string;\r\n  onlyThisDevice: boolean;\r\n  lastModifiedCutoff: number; // \u2190 Tracks last timestamp for incremental fetches\r\n  cachedAt: number; // Timestamp when cache was saved to IndexedDB\r\n}\r\n\r\nexport interface InitializationState {\r\n  inProgress: boolean;\r\n  completed: boolean;\r\n  error: Error | null;\r\n  timestamp: number | null;\r\n}\r\n\r\n// ============================================================================\r\n// WebSocket Types\r\n// ============================================================================\r\n\r\nexport enum WS_READY_STATE {\r\n  CONNECTING = 0,\r\n  OPEN = 1,\r\n  CLOSING = 2,\r\n  CLOSED = 3\r\n}\r\n\r\nexport interface WebSocketTickleMessage {\r\n  type: 'tickle';\r\n  subtype: 'push' | 'device';\r\n}\r\n\r\nexport interface WebSocketPushMessage {\r\n  type: 'push';\r\n  push: Push;\r\n}\r\n\r\nexport interface WebSocketNopMessage {\r\n  type: 'nop';\r\n}\r\n\r\nexport type WebSocketMessage = WebSocketTickleMessage | WebSocketPushMessage | WebSocketNopMessage;\r\n\r\n// ============================================================================\r\n// API Response Types\r\n// ============================================================================\r\n\r\nexport interface APIResponse<T> {\r\n  data?: T;\r\n  error?: {\r\n    type: string;\r\n    message: string;\r\n    cat?: string;\r\n  };\r\n}\r\n\r\nexport interface DevicesResponse {\r\n  devices: Device[];\r\n}\r\n\r\nexport interface PushesResponse {\r\n  pushes: Push[];\r\n  cursor?: string;\r\n}\r\n\r\nexport type UserResponse = User;\r\n\r\n// ============================================================================\r\n// Configuration Types\r\n// ============================================================================\r\n\r\nexport interface DebugConfig {\r\n  enabled: boolean;\r\n  categories: Record<string, boolean>;\r\n  logLevel: 'DEBUG' | 'INFO' | 'WARN' | 'ERROR';\r\n  maxLogEntries: number;\r\n  sanitizeData: boolean;\r\n}\r\n\r\nexport interface StorageConfig {\r\n  apiKey?: string;\r\n  deviceIden?: string;\r\n  deviceNickname?: string;\r\n  autoOpenLinks?: boolean;\r\n  notificationTimeout?: number;\r\n  onlyThisDevice?: boolean;\r\n  debugConfig?: DebugConfig;\r\n}\r\n\r\n// ============================================================================\r\n// Chrome Message Types\r\n// ============================================================================\r\n\r\nexport enum MessageAction {\r\n  GET_SESSION_DATA = 'getSessionData',\r\n  API_KEY_CHANGED = 'apiKeyChanged',\r\n  SESSION_DATA_UPDATED = 'sessionDataUpdated',\r\n  PUSHES_UPDATED = 'pushesUpdated',\r\n  SETTINGS_CHANGED = 'settingsChanged',\r\n  LOGOUT = 'logout',\r\n  REFRESH_SESSION = 'refreshSession',\r\n  UPDATE_DEVICE_NICKNAME = 'updateDeviceNickname',\r\n  LOG = 'log',\r\n  SEND_PUSH = 'sendPush',\r\n  GET_NOTIFICATION_DATA = 'getNotificationData',\r\n  CLEAR_ALL_LOGS = 'clearAllLogs',\r\n  UPDATE_DEBUG_CONFIG = 'updateDebugConfig',\r\n  EXPORT_DEBUG_DATA = 'exportDebugData',\r\n  GET_DEBUG_SUMMARY = 'getDebugSummary',\r\n  CONNECTION_STATE_CHANGED = 'connectionStateChanged',\r\n  AUTO_OPEN_LINKS_CHANGED = 'autoOpenLinksChanged',\r\n  ENCRYPTION_PASSWORD_CHANGED = 'encryptionPasswordChanged',\r\n  DEBUG_MODE_CHANGED = 'debugModeChanged',\r\n}\r\n\r\nexport interface GetSessionDataMessage {\r\n  action: MessageAction.GET_SESSION_DATA;\r\n}\r\n\r\nexport interface SessionDataResponse {\r\n  isAuthenticated: boolean;\r\n  userInfo: User | null;\r\n  devices: Device[];\r\n  recentPushes: Push[];\r\n  chats: Chat[]; // \u2190 ADD THIS\r\n  autoOpenLinks: boolean;\r\n  deviceNickname: string;\r\n  websocketConnected?: boolean;\r\n  onlyThisDevice?: boolean;\r\n  deviceIden?: string;\r\n}\r\n\r\nexport interface ApiKeyChangedMessage {\r\n  action: MessageAction.API_KEY_CHANGED;\r\n  apiKey: string;\r\n  deviceNickname?: string;\r\n}\r\n\r\nexport interface SessionDataUpdatedMessage {\r\n  action: MessageAction.SESSION_DATA_UPDATED;\r\n  isAuthenticated: boolean;\r\n  userInfo?: User | null;\r\n  devices?: Device[];\r\n  recentPushes?: Push[];\r\n  autoOpenLinks?: boolean;\r\n  deviceNickname?: string;\r\n}\r\n\r\nexport interface PushesUpdatedMessage {\r\n  action: MessageAction.PUSHES_UPDATED;\r\n  pushes: Push[];\r\n}\r\n\r\nexport interface SettingsChangedMessage {\r\n  action: MessageAction.SETTINGS_CHANGED;\r\n  autoOpenLinks?: boolean;\r\n  notificationTimeout?: number;\r\n  onlyThisDevice?: boolean;\r\n}\r\n\r\nexport interface LogoutMessage {\r\n  action: MessageAction.LOGOUT;\r\n}\r\n\r\nexport interface RefreshSessionMessage {\r\n  action: MessageAction.REFRESH_SESSION;\r\n}\r\n\r\nexport interface UpdateDeviceNicknameMessage {\r\n  action: MessageAction.UPDATE_DEVICE_NICKNAME;\r\n  nickname: string;\r\n}\r\n\r\nexport type ChromeMessage =\r\n  | GetSessionDataMessage\r\n  | ApiKeyChangedMessage\r\n  | SessionDataUpdatedMessage\r\n  | PushesUpdatedMessage\r\n  | SettingsChangedMessage\r\n  | LogoutMessage\r\n  | RefreshSessionMessage\r\n  | UpdateDeviceNicknameMessage;\r\n\r\n// ============================================================================\r\n// Type Guards\r\n// ============================================================================\r\n\r\nexport function isLinkPush(push: Push): push is LinkPush {\r\n  return push.type === 'link';\r\n}\r\n\r\nexport function isNotePush(push: Push): push is NotePush {\r\n  return push.type === 'note';\r\n}\r\n\r\nexport function isFilePush(push: Push): push is FilePush {\r\n  return push.type === 'file';\r\n}\r\n\r\nexport function isMirrorPush(push: Push): push is MirrorPush {\r\n  return push.type === 'mirror';\r\n}\r\n\r\nexport function isDismissalPush(push: Push): push is DismissalPush {\r\n  return push.type === 'dismissal';\r\n}\r\n\r\nexport function isTickleMessage(msg: WebSocketMessage): msg is WebSocketTickleMessage {\r\n  return msg.type === 'tickle';\r\n}\r\n\r\nexport function isPushMessage(msg: WebSocketMessage): msg is WebSocketPushMessage {\r\n  return msg.type === 'push';\r\n}\r\n\r\nexport function isNopMessage(msg: WebSocketMessage): msg is WebSocketNopMessage {\r\n  return msg.type === 'nop';\r\n}\r\n\r\n// ============================================================================\r\n// Validation Helpers\r\n// ============================================================================\r\n\r\nexport function isValidPush(push: unknown): push is Push {\r\n  if (!push || typeof push !== 'object') return false;\r\n  const p = push as Partial<Push>;\r\n  return typeof p.type === 'string' && ['link', 'note', 'file', 'mirror', 'dismissal'].includes(p.type);\r\n}\r\n\r\nexport function isValidDevice(device: unknown): device is Device {\r\n  if (!device || typeof device !== 'object') return false;\r\n  const d = device as Partial<Device>;\r\n  return typeof d.iden === 'string' && d.iden.length > 0;\r\n}\r\n\r\nexport function isValidUser(user: unknown): user is User {\r\n  if (!user || typeof user !== 'object') return false;\r\n  const u = user as Partial<User>;\r\n  return typeof u.iden === 'string' && u.iden.length > 0;\r\n}\r\n\r\n", "/**\n * DOM manipulation utilities for UI pages\n */\n\n/**\n * Safely get an element by ID with type checking\n */\nexport function getElementById<T extends HTMLElement>(id: string): T {\n  const element = document.getElementById(id);\n  if (!element) {\n    throw new Error(`Element with id \"${id}\" not found`);\n  }\n  return element as T;\n}\n\n/**\n * Safely query selector with type checking\n */\nexport function querySelector<T extends Element>(selector: string): T {\n  const element = document.querySelector(selector);\n  if (!element) {\n    throw new Error(`Element with selector \"${selector}\" not found`);\n  }\n  return element as T;\n}\n\n/**\n * Show an element\n */\nexport function show(element: HTMLElement): void {\n  element.style.display = '';\n}\n\n/**\n * Hide an element\n */\nexport function hide(element: HTMLElement): void {\n  element.style.display = 'none';\n}\n\n/**\n * Toggle element visibility\n */\nexport function toggle(element: HTMLElement): void {\n  if (element.style.display === 'none') {\n    show(element);\n  } else {\n    hide(element);\n  }\n}\n\n/**\n * Set text content safely\n */\nexport function setText(element: HTMLElement, text: string): void {\n  element.textContent = text;\n}\n\n/**\n * Set HTML content safely (sanitized)\n */\nexport function setHTML(element: HTMLElement, html: string): void {\n  // Basic sanitization - remove script tags\n  const sanitized = html.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '');\n  element.innerHTML = sanitized;\n}\n\n/**\n * Add event listener with type safety\n */\nexport function on<K extends keyof HTMLElementEventMap>(\n  element: HTMLElement,\n  event: K,\n  handler: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void\n): void {\n  element.addEventListener(event, handler);\n}\n\n/**\n * Format timestamp for display\n */\nexport function formatTimestamp(date: Date): string {\n  const now = new Date();\n  const diff = now.getTime() - date.getTime();\n  const seconds = Math.floor(diff / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n  const days = Math.floor(hours / 24);\n\n  if (seconds < 60) {\n    return 'just now';\n  } else if (minutes < 60) {\n    return `${minutes}m ago`;\n  } else if (hours < 24) {\n    return `${hours}h ago`;\n  } else if (days < 7) {\n    return `${days}d ago`;\n  } else {\n    return date.toLocaleDateString();\n  }\n}\n\n/**\n * Show status message\n */\nexport function showStatus(element: HTMLElement, message: string, type: 'success' | 'error' | 'info' = 'info'): void {\n  element.textContent = message;\n  element.className = `status-message status-${type}`;\n  show(element);\n  \n  // Auto-hide after 3 seconds\n  setTimeout(() => {\n    hide(element);\n  }, 3000);\n}\n\n/**\n * Clear all children of an element\n */\nexport function clearChildren(element: HTMLElement): void {\n  while (element.firstChild) {\n    element.removeChild(element.firstChild);\n  }\n}\n\n", "/**\r\n * Storage Repository Pattern\r\n * \r\n * This module implements the Repository Pattern for storage operations.\r\n * It abstracts away the chrome.storage API, making the code more testable\r\n * and maintainable.\r\n * \r\n * Benefits:\r\n * - Testability: Easy to mock storage in tests\r\n * - Maintainability: Storage logic centralized in one place\r\n * - Clarity: Simple, clear API for storage operations\r\n */\r\n\r\n/**\r\n * Storage Repository Interface\r\n * \r\n * This interface defines the contract for storage operations.\r\n * Any implementation must provide these methods.\r\n */\r\nexport interface StorageRepository {\r\n  // API Key\r\n  getApiKey(): Promise<string | null>;\r\n  setApiKey(key: string | null): Promise<void>;\r\n\r\n  // Device Information\r\n  getDeviceIden(): Promise<string | null>;\r\n  setDeviceIden(iden: string | null): Promise<void>;\r\n\r\n  getDeviceNickname(): Promise<string | null>;\r\n  setDeviceNickname(nickname: string): Promise<void>;\r\n\r\n  // Settings\r\n  getAutoOpenLinks(): Promise<boolean>;\r\n  setAutoOpenLinks(enabled: boolean): Promise<void>;\r\n\r\n  getNotificationTimeout(): Promise<number>;\r\n  setNotificationTimeout(timeout: number): Promise<void>;\r\n\r\n  getOnlyThisDevice(): Promise<boolean>;\r\n  setOnlyThisDevice(value: boolean): Promise<void>;\r\n\r\n  // Encryption\r\n  getEncryptionPassword(): Promise<string | null>;\r\n  setEncryptionPassword(password: string | null): Promise<void>;\r\n\r\n  // UI State\r\n  getScrollToRecentPushes(): Promise<boolean>;\r\n  setScrollToRecentPushes(scroll: boolean): Promise<void>;\r\n  removeScrollToRecentPushes(): Promise<void>;\r\n\r\n  // Device Registration\r\n  getDeviceRegistrationInProgress(): Promise<boolean>;\r\n  setDeviceRegistrationInProgress(inProgress: boolean): Promise<void>;\r\n\r\n  // Last Modified Cutoff\r\n  getLastModifiedCutoff(): Promise<number | null>;\r\n  setLastModifiedCutoff(value: number): Promise<void>;\r\n  removeLastModifiedCutoff(): Promise<void>;\r\n\r\n  // Auto Open Links on Reconnect\r\n  getLastAutoOpenCutoff(): Promise<number | null>;\r\n  setLastAutoOpenCutoff(value: number): Promise<void>;\r\n  getAutoOpenLinksOnReconnect(): Promise<boolean>;\r\n  setAutoOpenLinksOnReconnect(value: boolean): Promise<void>;\r\n  getMaxAutoOpenPerReconnect(): Promise<number>;\r\n  setMaxAutoOpenPerReconnect(value: number): Promise<void>;\r\n  getDismissAfterAutoOpen(): Promise<boolean>;\r\n  setDismissAfterAutoOpen(value: boolean): Promise<void>;\r\n\r\n  // User Info Cache\r\n  getUserInfoCache(): Promise<any | null>;\r\n  setUserInfoCache(value: any): Promise<void>;\r\n\r\n  // Bulk Operations\r\n  clear(): Promise<void>;\r\n  remove(keys: string[]): Promise<void>;\r\n\r\n  // Diagnostics\r\n  getAutoOpenDebugSnapshot(): Promise<{\r\n    lastAutoOpenCutoff: number;\r\n    lastModifiedCutoff: number;\r\n    mruCount: number;\r\n    maxOpenedCreated: number;\r\n  }>;\r\n}\r\n\r\n/**\r\n * Chrome Storage Repository Implementation\r\n * \r\n * This class implements the StorageRepository interface using the\r\n * chrome.storage API. It handles the promisification of the callback-based\r\n * chrome.storage API.\r\n */\r\nexport class ChromeStorageRepository implements StorageRepository {\r\n  /**\r\n   * Get API Key from local storage\r\n   * Security: API keys are stored in local storage (not synced) to prevent\r\n   * exposure through Chrome's sync infrastructure\r\n   */\r\n  async getApiKey(): Promise<string | null> {\r\n    const result = await chrome.storage.local.get(['apiKey']);\r\n    return result.apiKey || null;\r\n  }\r\n\r\n  /**\r\n   * Set API Key in local storage\r\n   * Security: API keys are stored in local storage (not synced) to prevent\r\n   * exposure through Chrome's sync infrastructure\r\n   */\r\n  async setApiKey(key: string | null): Promise<void> {\r\n    if (key === null) {\r\n      await chrome.storage.local.remove(['apiKey']);\r\n    } else {\r\n      await chrome.storage.local.set({ apiKey: key });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Device Identifier from local storage\r\n   */\r\n  async getDeviceIden(): Promise<string | null> {\r\n    const result = await chrome.storage.local.get(['deviceIden']);\r\n    return result.deviceIden || null;\r\n  }\r\n\r\n  /**\r\n   * Set Device Identifier in local storage\r\n   */\r\n  async setDeviceIden(iden: string | null): Promise<void> {\r\n    if (iden === null) {\r\n      await chrome.storage.local.remove(['deviceIden']);\r\n    } else {\r\n      await chrome.storage.local.set({ deviceIden: iden });\r\n    }\r\n  }\r\n\r\n  /**\r\n    * Get Device Nickname from local storage\r\n    */\r\n  async getDeviceNickname(): Promise<string | null> {\r\n    const result = await chrome.storage.local.get(['deviceNickname']);\r\n    return result.deviceNickname || null;\r\n  }\r\n\r\n  /**\r\n    * Set Device Nickname in local storage\r\n    */\r\n  async setDeviceNickname(nickname: string): Promise<void> {\r\n    await chrome.storage.local.set({ deviceNickname: nickname });\r\n  }\r\n\r\n  /**\r\n   * Get Auto Open Links setting from sync storage\r\n   */\r\n  async getAutoOpenLinks(): Promise<boolean> {\r\n    const result = await chrome.storage.sync.get(['autoOpenLinks']);\r\n    return result.autoOpenLinks !== undefined ? result.autoOpenLinks : false;\r\n  }\r\n\r\n  /**\r\n   * Set Auto Open Links setting in sync storage\r\n   */\r\n  async setAutoOpenLinks(enabled: boolean): Promise<void> {\r\n    await chrome.storage.sync.set({ autoOpenLinks: enabled });\r\n  }\r\n\r\n  /**\r\n   * Get Notification Timeout from sync storage\r\n   */\r\n  async getNotificationTimeout(): Promise<number> {\r\n    const result = await chrome.storage.sync.get(['notificationTimeout']);\r\n    return result.notificationTimeout !== undefined ? result.notificationTimeout : 5000;\r\n  }\r\n\r\n  /**\r\n   * Set Notification Timeout in sync storage\r\n   */\r\n  async setNotificationTimeout(timeout: number): Promise<void> {\r\n    await chrome.storage.sync.set({ notificationTimeout: timeout });\r\n  }\r\n\r\n  /**\r\n   * Get Only This Device setting from sync storage\r\n   */\r\n  async getOnlyThisDevice(): Promise<boolean> {\r\n    const result = await chrome.storage.sync.get(['onlyThisDevice']);\r\n    return result.onlyThisDevice !== undefined ? result.onlyThisDevice : false;\r\n  }\r\n\r\n  /**\r\n   * Set Only This Device setting in sync storage\r\n   */\r\n  async setOnlyThisDevice(value: boolean): Promise<void> {\r\n    await chrome.storage.sync.set({ onlyThisDevice: value });\r\n  }\r\n\r\n  /**\n   * Get Encryption Password from local storage\n   */\n  async getEncryptionPassword(): Promise<string | null> {\n    const result = await chrome.storage.local.get(['encryptionPassword']);\r\n    return result.encryptionPassword || null;\r\n  }\r\n\r\n  /**\r\n   * Set Encryption Password in local storage\r\n   */\r\n  async setEncryptionPassword(password: string | null): Promise<void> {\r\n    if (password === null) {\r\n      await chrome.storage.local.remove(['encryptionPassword']);\r\n    } else {\r\n      await chrome.storage.local.set({ encryptionPassword: password });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get Scroll to Recent Pushes flag from local storage\r\n   */\r\n  async getScrollToRecentPushes(): Promise<boolean> {\r\n    const result = await chrome.storage.local.get(['scrollToRecentPushes']);\r\n    return result.scrollToRecentPushes || false;\r\n  }\r\n\r\n  /**\r\n   * Set Scroll to Recent Pushes flag in local storage\r\n   */\r\n  async setScrollToRecentPushes(scroll: boolean): Promise<void> {\r\n    await chrome.storage.local.set({ scrollToRecentPushes: scroll });\r\n  }\r\n\r\n  /**\r\n   * Remove Scroll to Recent Pushes flag from local storage\r\n   */\r\n  async removeScrollToRecentPushes(): Promise<void> {\r\n    await chrome.storage.local.remove(['scrollToRecentPushes']);\r\n  }\r\n\r\n  /**\r\n   * Get Device Registration In Progress flag from local storage\r\n   */\r\n  async getDeviceRegistrationInProgress(): Promise<boolean> {\r\n    const result = await chrome.storage.local.get(['deviceRegistrationInProgress']);\r\n    return result.deviceRegistrationInProgress || false;\r\n  }\r\n\r\n  /**\r\n   * Set Device Registration In Progress flag in local storage\r\n   */\r\n  async setDeviceRegistrationInProgress(inProgress: boolean): Promise<void> {\r\n    await chrome.storage.local.set({ deviceRegistrationInProgress: inProgress });\r\n  }\r\n\r\n  /**\r\n   * Get Last Modified Cutoff from local storage\r\n   */\r\n  async getLastModifiedCutoff(): Promise<number | null> {\r\n    const result = await chrome.storage.local.get(['lastModifiedCutoff']);\r\n    const cutoff = result.lastModifiedCutoff;\r\n    return typeof cutoff === 'number' ? cutoff : null;\r\n  }\r\n\r\n  /**\r\n   * Set Last Modified Cutoff in local storage\r\n   */\r\n  async setLastModifiedCutoff(value: number): Promise<void> {\r\n    if (value === 0) {\r\n      console.warn('Storage: Setting lastModifiedCutoff to 0 - ensure this is via unsafe setter');\r\n    }\r\n    await chrome.storage.local.set({ lastModifiedCutoff: value });\r\n  }\r\n\r\n  /**\r\n   * Remove Last Modified Cutoff from local storage\r\n   * Used during invalid cursor recovery\r\n   */\r\n  async removeLastModifiedCutoff(): Promise<void> {\r\n    await chrome.storage.local.remove('lastModifiedCutoff');\r\n  }\r\n\r\n  /**\r\n   * Get Last Auto Open Cutoff from local storage\r\n   */\r\n  async getLastAutoOpenCutoff(): Promise<number | null> {\r\n    const result = await chrome.storage.local.get(['lastAutoOpenCutoff']);\r\n    const v = result.lastAutoOpenCutoff;\r\n    return typeof v === 'number' ? v : null;\r\n  }\r\n\r\n  /**\r\n   * Set Last Auto Open Cutoff in local storage\r\n   */\r\n  async setLastAutoOpenCutoff(value: number): Promise<void> {\r\n    await chrome.storage.local.set({ lastAutoOpenCutoff: value });\r\n  }\r\n\r\n  /**\r\n   * Get Auto Open Links on Reconnect setting from local storage\r\n   */\r\n  async getAutoOpenLinksOnReconnect(): Promise<boolean> {\r\n    const result = await chrome.storage.local.get(['autoOpenLinksOnReconnect']);\r\n    const v = result.autoOpenLinksOnReconnect;\r\n    return typeof v === 'boolean' ? v : false;\r\n  }\r\n\r\n  /**\r\n   * Set Auto Open Links on Reconnect setting in local storage\r\n   */\r\n  async setAutoOpenLinksOnReconnect(value: boolean): Promise<void> {\r\n    await chrome.storage.local.set({ autoOpenLinksOnReconnect: value });\r\n  }\r\n\r\n  /**\r\n   * Get Max Auto Open Per Reconnect from local storage\r\n   */\r\n  async getMaxAutoOpenPerReconnect(): Promise<number> {\r\n    const result = await chrome.storage.local.get(['maxAutoOpenPerReconnect']);\r\n    const v = result.maxAutoOpenPerReconnect;\r\n    return typeof v === 'number' && v > 0 ? v : 5;\r\n  }\r\n\r\n  /**\r\n   * Set Max Auto Open Per Reconnect in local storage\r\n   */\r\n  async setMaxAutoOpenPerReconnect(value: number): Promise<void> {\r\n    await chrome.storage.local.set({ maxAutoOpenPerReconnect: value });\r\n  }\r\n\r\n  /**\r\n   * Get Dismiss After Auto Open setting from local storage\r\n   */\r\n  async getDismissAfterAutoOpen(): Promise<boolean> {\r\n    const result = await chrome.storage.local.get(['dismissAfterAutoOpen']);\r\n    return Boolean(result.dismissAfterAutoOpen);\r\n  }\r\n\r\n  /**\r\n   * Set Dismiss After Auto Open setting in local storage\r\n   */\r\n  async setDismissAfterAutoOpen(value: boolean): Promise<void> {\r\n    await chrome.storage.local.set({ dismissAfterAutoOpen: value });\r\n  }\r\n\r\n  /**\r\n   * Get User Info Cache from local storage\r\n   */\r\n  async getUserInfoCache(): Promise<any | null> {\r\n    const result = await chrome.storage.local.get(['userInfoCache']);\r\n    return result.userInfoCache || null;\r\n  }\r\n\r\n  /**\r\n   * Set User Info Cache in local storage\r\n   */\r\n  async setUserInfoCache(value: any): Promise<void> {\r\n    await chrome.storage.local.set({ userInfoCache: value });\r\n  }\r\n\r\n  /**\r\n   * Clear all storage (both sync and local)\r\n   */\r\n  async clear(): Promise<void> {\r\n    await Promise.all([\r\n      chrome.storage.sync.clear(),\r\n      chrome.storage.local.clear()\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Remove specific keys from storage\r\n   * Removes from both sync and local storage\r\n   */\r\n  async remove(keys: string[]): Promise<void> {\r\n    await Promise.all([\r\n      chrome.storage.sync.remove(keys),\r\n      chrome.storage.local.remove(keys)\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Get Auto Open Debug Snapshot for diagnostics\r\n   */\r\n  async getAutoOpenDebugSnapshot(): Promise<{\r\n    lastAutoOpenCutoff: number;\r\n    lastModifiedCutoff: number;\r\n    mruCount: number;\r\n    maxOpenedCreated: number;\r\n  }> {\r\n    const { lastAutoOpenCutoff = 0 } =\r\n      await chrome.storage.local.get('lastAutoOpenCutoff');\r\n    const { lastModifiedCutoff = 0 } =\r\n      await chrome.storage.local.get('lastModifiedCutoff');\r\n    const raw = await chrome.storage.local.get('openedPushMRU');\r\n    const mru = raw.openedPushMRU as\r\n      | { idens?: string[]; maxOpenedCreated?: number }\r\n      | undefined;\r\n    return {\r\n      lastAutoOpenCutoff:\r\n        typeof lastAutoOpenCutoff === 'number' ? lastAutoOpenCutoff : 0,\r\n      lastModifiedCutoff:\r\n        typeof lastModifiedCutoff === 'number' ? lastModifiedCutoff : 0,\r\n      mruCount: Array.isArray(mru?.idens) ? mru!.idens!.length : 0,\r\n      maxOpenedCreated:\r\n        typeof mru?.maxOpenedCreated === 'number' ? mru!.maxOpenedCreated! : 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Create a singleton instance of the storage repository\r\n * This ensures we have a single point of access throughout the application\r\n */\r\nexport const storageRepository = new ChromeStorageRepository();\r\n\r\n", "/**\r\n * Popup page - Full TypeScript implementation\r\n */\r\n\r\nimport type { Push, Device, User, Chat, SessionDataResponse } from \"../types/domain\";\r\nimport { MessageAction, isMirrorPush } from \"../types/domain\";\r\nimport {\r\n  getElementById,\r\n} from \"../lib/ui/dom\";\r\nimport { storageRepository } from \"../infrastructure/storage/storage.repository\";\r\n\r\n// Response type for API key save operations\r\ntype SaveKeyResponse = SessionDataResponse | { success: false; error?: string };\r\n\r\n// API URLs - MOSTLY REMOVED\r\n// ARCHITECTURAL CHANGE: Popup no longer makes direct API calls\r\n// All API communication is centralized in the background script\r\n//\r\n// EXCEPTION: File upload still requires direct API access because:\r\n// - FormData cannot be serialized through chrome.runtime.sendMessage\r\n// - File upload involves two steps: upload-request + S3 upload\r\n// - The final push creation is still delegated to background\r\n//\r\n// Removed URLs (now handled by background):\r\n// - USER_INFO_URL (user info fetched by background)\r\n// - DEVICES_URL (devices fetched by background)\r\n// - PUSHES_URL (pushes sent via background)\r\n// - WEBSOCKET_URL (WebSocket managed by background)\r\n\r\n// Type definitions\r\ninterface SessionData {\r\n  isAuthenticated: boolean;\r\n  userInfo: User | null;\r\n  devices: Device[];\r\n  recentPushes: Push[];\r\n  chats: Chat[]; // \u2190 ADD THIS\r\n  autoOpenLinks: boolean;\r\n  websocketConnected?: boolean;\r\n  deviceNickname: string;\r\n  state?: string; // State machine state\r\n}\r\n\r\ntype PushType = \"note\" | \"link\" | \"file\";\r\n\r\ninterface PushData {\r\n  type: PushType;\r\n  device_iden?: string;\r\n  email?: string;\r\n  source_device_iden?: string;\r\n  title?: string;\r\n  body?: string;\r\n  url?: string;\r\n  file_name?: string;\r\n  file_type?: string;\r\n  file_url?: string;\r\n}\r\n\r\ninterface UploadRequestResponse {\r\n  file_name: string;\r\n  file_type: string;\r\n  file_url: string;\r\n  upload_url: string;\r\n  data: Record<string, string>;\r\n}\r\n\r\n// DOM elements\r\nconst loadingSection = getElementById<HTMLDivElement>(\"loading-section\");\r\nconst loginSection = getElementById<HTMLDivElement>(\"login-section\");\r\nconst mainSection = getElementById<HTMLDivElement>(\"main-section\");\r\nconst errorStatePanel = getElementById<HTMLDivElement>(\"error-state-panel\");\r\nconst manualReconnectBtn = getElementById<HTMLButtonElement>(\"manual-reconnect-btn\");\r\nconst apiKeyInput = getElementById<HTMLInputElement>(\"api-key\");\r\nconst deviceNicknameInput = getElementById<HTMLInputElement>(\"device-nickname\");\r\nconst saveApiKeyButton = getElementById<HTMLButtonElement>(\"save-api-key\");\r\nconst logoutButton = getElementById<HTMLButtonElement>(\"logout\");\r\nconst userImage = getElementById<HTMLImageElement>(\"user-image\");\r\nconst userName = getElementById<HTMLSpanElement>(\"user-name\");\r\n// Connection indicator removed - using badge instead\r\nconst pushTypeNoteBtn = getElementById<HTMLButtonElement>(\"push-type-note\");\r\nconst pushTypeLinkBtn = getElementById<HTMLButtonElement>(\"push-type-link\");\r\nconst pushTypeFileBtn = getElementById<HTMLButtonElement>(\"push-type-file\");\r\nconst noteForm = getElementById<HTMLDivElement>(\"note-form\");\r\nconst linkForm = getElementById<HTMLDivElement>(\"link-form\");\r\nconst fileForm = getElementById<HTMLDivElement>(\"file-form\");\r\nconst fileInput = getElementById<HTMLInputElement>(\"file-input\");\r\nconst fileSelected = getElementById<HTMLDivElement>(\"file-selected\");\r\nconst fileName = getElementById<HTMLSpanElement>(\"file-name\");\r\nconst fileSize = getElementById<HTMLSpanElement>(\"file-size\");\r\nconst noteTitleInput = getElementById<HTMLInputElement>(\"note-title\");\r\nconst noteBodyInput = getElementById<HTMLTextAreaElement>(\"note-body\");\r\nconst linkTitleInput = getElementById<HTMLInputElement>(\"link-title\");\r\nconst linkUrlInput = getElementById<HTMLInputElement>(\"link-url\");\r\nconst linkBodyInput = getElementById<HTMLTextAreaElement>(\"link-body\");\r\nconst targetDeviceSelect = getElementById<HTMLSelectElement>(\"target-device\");\r\nconst sendPushButton = getElementById<HTMLButtonElement>(\"send-push\");\r\nconst pushesList = getElementById<HTMLDivElement>(\"pushes-list\");\r\nconst statusMessage = getElementById<HTMLDivElement>(\"status-message\");\r\nconst openSettingsBtn = getElementById<HTMLButtonElement>(\"open-settings\");\r\nconst openDebugDashboardBtn = getElementById<HTMLButtonElement>(\r\n  \"open-debug-dashboard\",\r\n);\r\n\r\n// State variables\r\nlet deviceNickname = \"Chrome\";\r\nconst devices: Device[] = [];\r\nlet currentPushType: PushType = \"note\";\r\n// websocket variable removed - background script manages the single WebSocket connection\r\n\r\n/**\r\n * Initialize popup\r\n */\r\nfunction init(): void {\r\n  console.log(\"Popup initializing\");\r\n  setupEventListeners();\r\n  checkStorageForApiKey();\r\n}\r\n\r\n/**\r\n * Initialize from session data (from background)\r\n */\r\nasync function initializeFromSessionData(response: SessionData): Promise<void> {\r\n  if (!response.isAuthenticated) {\r\n    showSection(\"login\");\r\n    return;\r\n  }\r\n\r\n  // Check if extension is in error state\r\n  if (response.state === 'error') {\r\n    showSection(\"error\");\r\n    return;\r\n  }\r\n\r\n  // Update device nickname\r\n  deviceNickname = response.deviceNickname;\r\n  console.log(\"Device nickname:\", deviceNickname);\r\n\r\n  // Update user info\r\n  if (response.userInfo) {\r\n    updateUserInfo(response.userInfo);\r\n  }\r\n\r\n  // Populate device dropdown\r\n  populateDeviceDropdown(response.devices, response.chats);\r\n\r\n  // Display pushes\r\n  displayPushes(response.recentPushes);\r\n\r\n  // Get version from manifest\r\n  const manifest = chrome.runtime.getManifest();\r\n  const version = manifest.version;\r\n\r\n  // Update the \"Send a Push\" heading with version\r\n  const sendPushHeading = document.getElementById('send-push-heading');\r\n  if (sendPushHeading) {\r\n    sendPushHeading.innerHTML = `Send a Push <span class=\"version-text\">(v.${version})</span>`;\r\n  }\r\n\r\n  // Show main section\r\n  showSection(\"main\");\r\n\r\n  // Connection status is now shown via badge icon (no UI indicator needed)\r\n  // WebSocket connection is managed by background script - popup receives updates via chrome.runtime.onMessage\r\n}\r\n\r\n/**\r\n * Check storage for API key and get session data from background\r\n * ARCHITECTURAL CHANGE: Popup no longer makes direct API calls.\r\n * All data is fetched from background script's session cache.\r\n */\r\nfunction checkStorageForApiKey(): void {\r\n  console.log(\"Requesting session data from background\");\r\n  showSection(\"loading\");\r\n\r\n  // Request session data from background script (single source of truth)\r\n  chrome.runtime.sendMessage(\r\n    { action: MessageAction.GET_SESSION_DATA },\r\n    async (response: SessionData) => {\r\n      if (chrome.runtime.lastError) {\r\n        console.error(\"Error getting session data:\", chrome.runtime.lastError);\r\n        showSection(\"login\");\r\n        return;\r\n      }\r\n\r\n      if (response.isAuthenticated) {\r\n        // Initialize from background's cached data\r\n        await initializeFromSessionData(response);\r\n\r\n        // Check if we should scroll to recent pushes\r\n        const shouldScroll = await storageRepository.getScrollToRecentPushes();\r\n        if (shouldScroll) {\r\n          await storageRepository.removeScrollToRecentPushes();\r\n          setTimeout(() => {\r\n            scrollToRecentPushes();\r\n          }, 100);\r\n        }\r\n      } else {\r\n        showSection(\"login\");\r\n      }\r\n    },\r\n  );\r\n}\r\n\r\n/**\r\n * Show section\r\n */\r\nfunction showSection(section: \"loading\" | \"login\" | \"main\" | \"error\"): void {\r\n  console.log(\"Showing section:\", section);\r\n  loadingSection.style.display = section === \"loading\" ? \"flex\" : \"none\";\r\n  loginSection.style.display = section === \"login\" ? \"block\" : \"none\";\r\n  mainSection.style.display = section === \"main\" ? \"block\" : \"none\";\r\n  errorStatePanel.style.display = section === \"error\" ? \"block\" : \"none\";\r\n}\r\n\r\n/**\r\n * Handles global keyboard shortcuts for the popup.\r\n * This function responds to hotkeys like N, L, A for switching modes,\r\n * and Ctrl+Enter for instant send.\r\n *\r\n * @param event - The keyboard event\r\n */\r\nfunction handleGlobalHotkeys(event: KeyboardEvent): void {\r\n  // IMPORTANT: Get the element that's currently focused\r\n  const target = event.target as HTMLElement;\r\n  const isTypingInInput =\r\n    target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement;\r\n\r\n  // === HANDLE CTRL+ENTER (works from ANY field) ===\r\n  if (event.ctrlKey && event.key === \"Enter\") {\r\n    event.preventDefault(); // Stop the browser's default behavior\r\n    sendPush(); // Call the existing send function\r\n    return; // Exit early - we're done\r\n  }\r\n\r\n  // === PREVENT HOTKEYS WHILE TYPING ===\r\n  // If user is typing in a text field, don't trigger mode-switching hotkeys\r\n  // (This prevents \"n\" from switching to Note mode while typing \"connect\")\r\n  if (isTypingInInput) {\r\n    return; // Exit - let the user type normally\r\n  }\r\n\r\n  // === MODE-SWITCHING HOTKEYS ===\r\n  // Convert key to lowercase so both \"N\" and \"n\" work\r\n  const key = event.key.toLowerCase();\r\n\r\n  switch (key) {\r\n  case \"n\":\r\n    // Switch to Note mode and focus the title input\r\n    event.preventDefault();\r\n    togglePushType(\"note\");\r\n    // Wait a tiny bit for the form to show, then focus\r\n    setTimeout(() => noteTitleInput.focus(), 50);\r\n    break;\r\n\r\n  case \"l\":\r\n    // Switch to Link mode and focus the COMMENT field (URL is auto-filled)\r\n    event.preventDefault();\r\n    togglePushType(\"link\");\r\n    // Wait for togglePushType to finish auto-filling the URL\r\n    setTimeout(() => linkBodyInput.focus(), 100);\r\n    break;\r\n\r\n  case \"a\":\r\n    // Switch to Attach mode and open file picker\r\n    event.preventDefault();\r\n    togglePushType(\"file\");\r\n    // Trigger the file input's click to open file picker dialog\r\n    setTimeout(() => fileInput.click(), 50);\r\n    break;\r\n\r\n  case \"s\":\r\n    // Open Settings page\r\n    event.preventDefault();\r\n    chrome.runtime.openOptionsPage();\r\n    break;\r\n\r\n  case \"d\":\r\n    // Open Debug Dashboard\r\n    event.preventDefault();\r\n    chrome.tabs.create({\r\n      url: chrome.runtime.getURL(\"debug-dashboard.html\"),\r\n    });\r\n    break;\r\n\r\n  case \"p\":\r\n    // Open Pushbullet website\r\n    event.preventDefault();\r\n    chrome.tabs.create({\r\n      url: \"https://www.pushbullet.com\",\r\n    });\r\n    break;\r\n\r\n    // ESC is handled by Chrome automatically - it closes popups by default\r\n  }\r\n}\r\n\r\n/**\r\n * Set up event listeners\r\n */\r\nfunction setupEventListeners(): void {\r\n  // Save API key button\r\n  saveApiKeyButton.addEventListener(\"click\", saveApiKey);\r\n\r\n  // API key input - save on Enter\r\n  apiKeyInput.addEventListener(\"keyup\", (event) => {\r\n    if (event.key === \"Enter\") {\r\n      saveApiKey();\r\n    }\r\n  });\r\n\r\n  // Device nickname input - save on Enter\r\n  deviceNicknameInput.addEventListener(\"keyup\", (event) => {\r\n    if (event.key === \"Enter\") {\r\n      saveApiKey();\r\n    }\r\n  });\r\n\r\n  // Logout button\r\n  logoutButton.addEventListener(\"click\", logout);\r\n\r\n  // Push type buttons\r\n  pushTypeNoteBtn.addEventListener(\"click\", () => togglePushType(\"note\"));\r\n  pushTypeLinkBtn.addEventListener(\"click\", () => togglePushType(\"link\"));\r\n  pushTypeFileBtn.addEventListener(\"click\", () => togglePushType(\"file\"));\r\n\r\n  // File input\r\n  fileInput.addEventListener(\"change\", handleFileSelect);\r\n\r\n  // Send push button\r\n  sendPushButton.addEventListener(\"click\", sendPush);\r\n\r\n  // Open settings\r\n  openSettingsBtn.addEventListener(\"click\", () => {\r\n    chrome.runtime.openOptionsPage();\r\n  });\r\n\r\n  // Open debug dashboard\r\n  openDebugDashboardBtn.addEventListener(\"click\", () => {\r\n    chrome.tabs.create({\r\n      url: chrome.runtime.getURL(\"debug-dashboard.html\"),\r\n    });\r\n  });\r\n\r\n  // Manual reconnect button\r\n  manualReconnectBtn.addEventListener('click', async () => {\r\n    // Send message to background to attempt reconnection\r\n    await chrome.runtime.sendMessage({\r\n      action: 'attemptReconnect'\r\n    });\r\n\r\n    // Close popup\r\n    window.close();\r\n  });\r\n\r\n  // === NEW CODE: Global keyboard shortcuts ===\r\n  document.addEventListener(\"keydown\", handleGlobalHotkeys);\r\n  // === END NEW CODE ===\r\n}\r\n\r\n/**\r\n * Save API key\r\n * ARCHITECTURAL CHANGE: Delegates API key validation to background script\r\n */\r\nasync function saveApiKey(): Promise<void> {\r\n  const newApiKey = apiKeyInput.value.trim();\r\n  const newNickname = deviceNicknameInput.value.trim() || \"Chrome\";\r\n\r\n  if (!newApiKey) {\r\n    showStatus(\"Please enter an Access Token.\", \"error\");\r\n    return;\r\n  }\r\n\r\n  showSection(\"loading\");\r\n\r\n  try {\r\n    // Save to storage repository\r\n    await storageRepository.setApiKey(newApiKey);\r\n    await storageRepository.setDeviceNickname(newNickname);\r\n\r\n    deviceNickname = newNickname;\r\n\r\n    // Notify background to validate and initialize\r\n    // Background will respond AFTER initialization is complete (no setTimeout needed!)\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: MessageAction.API_KEY_CHANGED,\r\n        apiKey: newApiKey,\r\n        deviceNickname: newNickname,\r\n      },\r\n      (response: SaveKeyResponse) => {\r\n        if (chrome.runtime.lastError) {\r\n          console.error(\r\n            \"Error notifying background:\",\r\n            chrome.runtime.lastError,\r\n          );\r\n          showStatus(\"Error: Could not connect to background script\", \"error\");\r\n          showSection(\"login\");\r\n          return;\r\n        }\r\n\r\n        // Type guard: Check if response is a successful session object\r\n        if ('isAuthenticated' in response) {\r\n          // Response is SessionData\r\n          if (response.isAuthenticated) {\r\n            initializeFromSessionData(response);\r\n          } else {\r\n            showStatus(\"Invalid Access Token\", \"error\");\r\n            showSection(\"login\");\r\n          }\r\n        } else {\r\n          // Response is error object\r\n          showStatus(\r\n            `Error: ${response.error || \"Invalid Access Token\"}`,\r\n            \"error\",\r\n          );\r\n          showSection(\"login\");\r\n        }\r\n      },\r\n    );\r\n  } catch (error) {\r\n    showStatus(`Error: ${(error as Error).message}`, \"error\");\r\n    showSection(\"login\");\r\n  }\r\n}\r\n\r\n/**\r\n * Logout\r\n */\r\nasync function logout(): Promise<void> {\r\n  // WebSocket disconnection is handled by background script\r\n  await storageRepository.setApiKey(null);\r\n  await storageRepository.setDeviceIden(null);\r\n\r\n  // Notify background script to disconnect WebSocket\r\n  chrome.runtime.sendMessage({ action: MessageAction.LOGOUT }).catch((error) => {\r\n    console.warn(\"Could not notify background of logout:\", error.message);\r\n  });\r\n\r\n  showSection(\"login\");\r\n  apiKeyInput.value = \"\";\r\n  deviceNicknameInput.value = \"\";\r\n}\r\n\r\n/**\r\n * REMOVED: initializeAuthenticated()\r\n *\r\n * This function previously made direct API calls to fetch user info, devices, and pushes.\r\n * It has been removed as part of the architectural refactoring to centralize all API\r\n * communication in the background script.\r\n *\r\n * The popup now uses initializeFromSessionData() which receives data from the background\r\n * script's session cache via chrome.runtime.sendMessage({ action: 'getSessionData' }).\r\n */\r\n\r\n/**\r\n * REMOVED: fetchUserInfo(), fetchDevices(), fetchRecentPushes()\r\n *\r\n * These functions previously made direct API calls to the Pushbullet API.\r\n * They have been removed as part of the architectural refactoring to centralize\r\n * all API communication in the background script.\r\n *\r\n * ARCHITECTURAL CHANGE:\r\n * - The popup is now a \"dumb client\" that only displays data\r\n * - All data comes from the background script's session cache\r\n * - The background script is the single source of truth for API state\r\n * - This eliminates redundant API calls every time the popup opens\r\n * - Improves efficiency and prevents state desynchronization\r\n *\r\n * Data flow:\r\n * 1. Popup opens \u2192 sends getSessionData message to background\r\n * 2. Background responds with cached session data\r\n * 3. Popup displays the data using initializeFromSessionData()\r\n * 4. Background proactively sends pushesUpdated when new data arrives\r\n */\r\n\r\n/**\r\n  * REMOVED: connectWebSocket() and disconnectWebSocket()\r\n  *\r\n  * The popup no longer maintains its own WebSocket connection.\r\n  * The background service worker manages a single, persistent WebSocket connection\r\n  * and sends push updates to the popup via chrome.runtime.sendMessage with action 'pushesUpdated'.\r\n  *\r\n  * This architectural change:\r\n  * - Eliminates dual state (popup and background having separate connections)\r\n  * - Reduces resource consumption (only one WebSocket connection)\r\n  * - Ensures connection persists when popup is closed\r\n  * - Makes background script the single source of truth for WebSocket state\r\n  */\r\n\r\n\r\n\r\n/**\r\n  * Update user info\r\n  */\r\nfunction updateUserInfo(userInfo: User): void {\r\n  userName.textContent = userInfo.name || userInfo.email || '';\r\n\r\n  if (userInfo.image_url) {\r\n    userImage.src = userInfo.image_url;\r\n    userImage.style.display = \"block\";\r\n  } else {\r\n    userImage.style.display = \"none\";\r\n  }\r\n}\r\n\r\n/**\r\n * Populate device dropdown\r\n */\r\nfunction populateDeviceDropdown(devicesList: Device[], chatsList?: Chat[]): void {\r\n  const devicesToUse = (devicesList || devices).filter(device =>\r\n    device.nickname || device.model || device.manufacturer || device.type\r\n  );\r\n\r\n  // Clear existing options except 'All Devices'\r\n  while (targetDeviceSelect.options.length > 1) {\r\n    targetDeviceSelect.remove(1);\r\n  }\r\n\r\n  // Add devices\r\n  devicesToUse.forEach((device) => {\r\n    const option = document.createElement(\"option\");\r\n    option.value = device.iden;\r\n    let displayName = device.nickname ||\r\n      `${device.manufacturer || ''} ${device.model || device.type || ''}`.trim() ||\r\n      \"Unknown Device\";\r\n    if (!device.active) displayName += \" (offline)\";\r\n    option.textContent = displayName;\r\n    targetDeviceSelect.appendChild(option);\r\n  });\r\n\r\n  // ========== ADD THIS ENTIRE SECTION ==========\r\n  // Add friends/contacts to dropdown\r\n  const chatsToUse = chatsList || [];\r\n  if (chatsToUse && chatsToUse.length > 0) {\r\n    // Add visual separator\r\n    const friendSeparator = document.createElement(\"option\");\r\n    friendSeparator.disabled = true;\r\n    friendSeparator.textContent = \"--- Friends ---\";\r\n    targetDeviceSelect.appendChild(friendSeparator);\r\n\r\n    // Add each friend\r\n    chatsToUse.forEach((chat) => {\r\n      const option = document.createElement(\"option\");\r\n\r\n      // Value: \"friend:<email>\" - lets us detect friend selection\r\n      option.value = `friend:${chat.with.email}`;\r\n\r\n      // Display: \"F: <name>\" or \"F: <email>\" if no name\r\n      const displayName = chat.with.name || chat.with.email;\r\n      option.textContent = `F: ${displayName}`;\r\n\r\n      targetDeviceSelect.appendChild(option);\r\n    });\r\n  }\r\n  // ========== END OF SECTION ==========\r\n}\r\n\r\n/**\r\n * Display pushes\r\n */\r\nfunction displayPushes(pushes: Push[]): void {\r\n  pushesList.innerHTML = \"\";\r\n\r\n  if (!pushes || pushes.length === 0) {\r\n    pushesList.innerHTML = \"<p>No recent pushes</p>\";\r\n    return;\r\n  }\r\n\r\n  // Show 10 most recent\r\n  const recentPushes = pushes.slice(0, 10);\r\n\r\n  recentPushes.forEach((push) => {\r\n    // Declare variables to hold the content for this specific push\r\n    let title: string | undefined;\r\n    let body: string | undefined;\r\n    let url: string | undefined;\r\n\r\n    // Use type guards based on 'push.type' to safely access properties\r\n    if (push.type === 'note') {\r\n      title = push.title;\r\n      body = push.body;\r\n    } else if (push.type === 'link') {\r\n      title = push.title;\r\n      url = push.url;\r\n      body = push.body;\r\n    } else if (isMirrorPush(push)) {\r\n      // ARCHITECTURAL NOTE: Mirror pushes can come from any Android app\r\n      // (SMS apps, WhatsApp, AntennaPod, etc.). The application_name field\r\n      // tells us which app sent the notification.\r\n\r\n      // Safely extract and sanitize the application name\r\n      const appName = push.application_name?.trim();\r\n\r\n      // Create a dynamic prefix based on the actual app name\r\n      // If application_name is missing or empty, don't add any prefix\r\n      const prefix = appName ? `${appName}: ` : '';\r\n\r\n      // Build the final title with the dynamic prefix\r\n      title = `${prefix}${push.title || ''}`;\r\n      body = push.body;\r\n\r\n      // DEBUGGING: Log cases where application_name is missing\r\n      // This helps us monitor data quality from the Pushbullet API\r\n      if (!appName) {\r\n        logToBackground(\"WARN\", \"[displayPushes] Mirror push missing application_name\", {\r\n          pushIden: push.iden,\r\n          pushTitle: push.title\r\n        });\r\n      }\r\n    } else if (push.type === 'sms_changed') {\r\n      // This also fixes the 'sms is possibly undefined' error\r\n      if (push.notifications && push.notifications.length > 0) {\r\n        const sms = push.notifications[0]!;\r\n        title = sms.title;\r\n        body = sms.body;\r\n      }\r\n    }\r\n\r\n    // Skip empty\r\n    if (!title && !body && !url) {\r\n      return;\r\n    }\r\n\r\n    const pushItem = document.createElement(\"div\");\r\n    pushItem.className = \"push-item\";\r\n\r\n    // Add SMS badge for SMS-related pushes\r\n    // Use package name matching for accuracy instead of app name heuristics\r\n    if (push.type === \"mirror\") {\r\n      // Known SMS app package names on Android\r\n      const smsPackages = [\r\n        \"com.google.android.apps.messaging\",  // Google Messages\r\n        \"com.android.mms\",                     // Stock Android SMS\r\n        \"com.samsung.android.messaging\",       // Samsung Messages\r\n        \"com.textra\",                           // Textra SMS\r\n      ];\r\n\r\n      const isSmsApp = push.package_name &&\r\n        smsPackages.some(pkg => push.package_name?.startsWith(pkg));\r\n\r\n      if (isSmsApp) {\r\n        pushItem.classList.add(\"push-sms\");\r\n      }\r\n    } else if (push.type === \"sms_changed\") {\r\n      // sms_changed type is ALWAYS SMS\r\n      pushItem.classList.add(\"push-sms\");\r\n    }\r\n\r\n    // Timestamp\r\n    if (push.created) {\r\n      const timestamp = new Date(push.created * 1000);\r\n      const timeElement = document.createElement(\"div\");\r\n      timeElement.className = \"push-time\";\r\n      timeElement.textContent = formatTimestamp(timestamp);\r\n      pushItem.appendChild(timeElement);\r\n    }\r\n\r\n    // Title\r\n    if (title) {\r\n      const titleEl = document.createElement(\"div\");\r\n      titleEl.className = \"push-title\";\r\n      titleEl.textContent = title || '';\r\n      pushItem.appendChild(titleEl);\r\n    }\r\n\r\n    // URL\r\n    if (url) {\r\n      const urlEl = document.createElement(\"a\");\r\n      urlEl.href = url as string;\r\n      urlEl.target = \"_blank\";\r\n      urlEl.className = \"push-url\";\r\n      urlEl.textContent = url || '';\r\n      pushItem.appendChild(urlEl);\r\n    }\r\n\r\n    // Body\r\n    if (body) {\r\n      const bodyEl = document.createElement(\"div\");\r\n      bodyEl.className = \"push-body\";\r\n      bodyEl.textContent = body || '';\r\n      pushItem.appendChild(bodyEl);\r\n    }\r\n\r\n    pushesList.appendChild(pushItem);\r\n  });\r\n}\r\n\r\n/**\r\n * Format timestamp\r\n */\r\nfunction formatTimestamp(date: Date): string {\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffSec = Math.floor(diffMs / 1000);\r\n  const diffMin = Math.floor(diffSec / 60);\r\n  const diffHour = Math.floor(diffMin / 60);\r\n  const diffDay = Math.floor(diffHour / 24);\r\n\r\n  if (diffDay > 0) {\r\n    return `${diffDay}d ago`;\r\n  } else if (diffHour > 0) {\r\n    return `${diffHour}h ago`;\r\n  } else if (diffMin > 0) {\r\n    return `${diffMin}m ago`;\r\n  } else {\r\n    return \"just now\";\r\n  }\r\n}\r\n\r\n/**\r\n * Handle file selection\r\n */\r\nfunction handleFileSelect(event: Event): void {\r\n  const target = event.target as HTMLInputElement;\r\n  const file = target.files?.[0];\r\n  if (file) {\r\n    fileName.textContent = file.name;\r\n    fileSize.textContent = formatFileSize(file.size);\r\n    fileSelected.style.display = \"block\";\r\n  } else {\r\n    fileSelected.style.display = \"none\";\r\n  }\r\n}\r\n\r\n/**\r\n * Format file size\r\n */\r\nfunction formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return \"0 Bytes\";\r\n  const k = 1024;\r\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + \" \" + sizes[i];\r\n}\r\n\r\n/**\r\n * Toggle push type\r\n */\r\nasync function togglePushType(type: PushType): Promise<void> {\r\n  currentPushType = type;\r\n\r\n  // Update buttons\r\n  pushTypeNoteBtn.classList.toggle(\"active\", type === \"note\");\r\n  pushTypeLinkBtn.classList.toggle(\"active\", type === \"link\");\r\n  pushTypeFileBtn.classList.toggle(\"active\", type === \"file\");\r\n\r\n  if (type === \"note\") {\r\n    noteForm.style.display = \"block\";\r\n    linkForm.style.display = \"none\";\r\n    fileForm.style.display = \"none\";\r\n  } else if (type === \"link\") {\r\n    noteForm.style.display = \"none\";\r\n    linkForm.style.display = \"block\";\r\n    fileForm.style.display = \"none\";\r\n\r\n    // Auto-populate with current tab\r\n    try {\r\n      const tabs = await chrome.tabs.query({\r\n        active: true,\r\n        currentWindow: true,\r\n      });\r\n      if (tabs[0]) {\r\n        linkUrlInput.value = tabs[0].url ? tabs[0].url : \"\";\r\n        linkTitleInput.value = tabs[0].title ? tabs[0].title : \"\";\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error getting current tab info:\", error);\r\n    }\r\n  } else if (type === \"file\") {\r\n    noteForm.style.display = \"none\";\r\n    linkForm.style.display = \"none\";\r\n    fileForm.style.display = \"block\";\r\n  }\r\n}\r\n\r\n/**\r\n * Send push\r\n */\r\nasync function sendPush(): Promise<void> {\r\n  logToBackground(\"INFO\", \"[sendPush] Function initiated.\");\r\n\r\n  try {\r\n    const pushType = currentPushType;\r\n    const targetDevice = targetDeviceSelect.value;\r\n\r\n    logToBackground(\"INFO\", `[sendPush] currentPushType is: '${pushType}'`);\r\n\r\n    const pushData: PushData = {\r\n      type: pushType,\r\n    };\r\n\r\n    // ========== REPLACE OLD CODE WITH THIS ==========\r\n    // Check if sending to friend or device\r\n    if (targetDevice !== \"all\") {\r\n      if (targetDevice.startsWith(\"friend:\")) {\r\n        // Sending to a friend - extract email\r\n        const email = targetDevice.replace(\"friend:\", \"\");\r\n        pushData.email = email; // Use email field, not device_iden\r\n\r\n        logToBackground(\"INFO\", \"Sending push to friend\", {\r\n          email: email,\r\n          pushType: pushType,\r\n        });\r\n      } else {\r\n        // Sending to a specific device\r\n        pushData.device_iden = targetDevice;\r\n\r\n        logToBackground(\"INFO\", \"Sending push to device\", {\r\n          deviceIden: targetDevice,\r\n          pushType: pushType,\r\n        });\r\n      }\r\n    } else {\r\n      // No selection = send to all devices\r\n      logToBackground(\"INFO\", \"Sending push to all devices\", {\r\n        pushType: pushType,\r\n      });\r\n    }\r\n    // ========== END OF REPLACEMENT ==========\r\n\r\n    // Set push data based on type\r\n    if (pushType === \"note\") {\r\n      logToBackground(\"INFO\", '[sendPush] Handling \"note\" type.');\r\n      pushData.title = noteTitleInput.value.trim();\r\n      pushData.body = noteBodyInput.value.trim();\r\n\r\n      if (!pushData.title && !pushData.body) {\r\n        logToBackground(\r\n          \"WARN\",\r\n          \"[sendPush] Exiting: Note title and body are empty.\",\r\n        );\r\n        showStatus(\"Please enter a title or body for the note.\", \"error\");\r\n        return;\r\n      }\r\n    } else if (pushType === \"link\") {\r\n      logToBackground(\"INFO\", '[sendPush] Handling \"link\" type.');\r\n      pushData.title = linkTitleInput.value.trim();\r\n      pushData.url = linkUrlInput.value.trim();\r\n      pushData.body = linkBodyInput.value.trim();\r\n\r\n      if (!pushData.url) {\r\n        logToBackground(\"WARN\", \"[sendPush] Exiting: Link URL is empty.\");\r\n        showStatus(\"Please enter a URL for the link.\", \"error\");\r\n        return;\r\n      }\r\n    } else if (pushType === \"file\") {\r\n      logToBackground(\"INFO\", '[sendPush] Handling \"file\" type.');\r\n      const file = fileInput.files?.[0];\r\n\r\n      showStatus(\"Uploading file...\", \"info\");\r\n\r\n      try {\r\n        // Check if file exists\r\n        if (!file) {\r\n          logToBackground(\r\n            \"WARN\",\r\n            \"[sendPush] Exiting: File type selected but no file is attached.\",\r\n          );\r\n          showStatus(\"Please select a file to attach.\", \"error\");\r\n          return;\r\n        }\r\n        const uploadApiKey = await storageRepository.getApiKey();\r\n        if (!uploadApiKey) {\r\n          logToBackground(\r\n            \"WARN\",\r\n            \"[sendPush] Exiting: Cannot upload file, user is not logged in.\",\r\n          );\r\n          showStatus(\"Not logged in. Please log in first.\", \"error\");\r\n          return;\r\n        }\r\n\r\n        // Request upload authorization\r\n        const uploadRequestResponse = await fetch(\r\n          \"https://api.pushbullet.com/v2/upload-request\",\r\n          {\r\n            method: \"POST\",\r\n            headers: {\r\n              \"Access-Token\": uploadApiKey,\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({\r\n              file_name: file.name,\r\n              file_type: file.type || \"application/octet-stream\",\r\n            }),\r\n          },\r\n        );\r\n\r\n        if (!uploadRequestResponse.ok) {\r\n          throw new Error(\"Failed to request file upload authorization\");\r\n        }\r\n\r\n        const uploadData =\r\n          (await uploadRequestResponse.json()) as UploadRequestResponse;\r\n\r\n        // Upload to S3\r\n        const formData = new FormData();\r\n        Object.keys(uploadData.data).forEach((key) => {\r\n          formData.append(key, uploadData.data[key] as string);\r\n        });\r\n        formData.append(\"file\", file);\r\n\r\n        const uploadResponse = await fetch(uploadData.upload_url, {\r\n          method: \"POST\",\r\n          body: formData,\r\n        });\r\n\r\n        if (!uploadResponse.ok) {\r\n          throw new Error(\"Failed to upload file to server\");\r\n        }\r\n\r\n        // Create file push\r\n        pushData.type = \"file\";\r\n        pushData.file_name = uploadData.file_name;\r\n        pushData.file_type = uploadData.file_type;\r\n        pushData.file_url = uploadData.file_url;\r\n        pushData.body = (\r\n          document.getElementById(\"file-body\") as HTMLTextAreaElement\r\n        ).value.trim();\r\n\r\n        showStatus(\"File uploaded, sending push...\", \"info\");\r\n      } catch (uploadError) {\r\n        logToBackground(\"ERROR\", \"[sendPush] File upload error.\", {\r\n          error: (uploadError as Error).message,\r\n        });\r\n        showStatus(\r\n          \"Failed to upload file: \" + (uploadError as Error).message,\r\n          \"error\",\r\n        );\r\n        return;\r\n      }\r\n    }\r\n\r\n    logToBackground(\r\n      \"INFO\",\r\n      \"[sendPush] Validation passed. Preparing to send message to background script.\",\r\n      pushData,\r\n    );\r\n\r\n    // Send push via background script\r\n    chrome.runtime.sendMessage(\r\n      {\r\n        action: MessageAction.SEND_PUSH,\r\n        pushData: pushData,\r\n      },\r\n      (response) => {\r\n        if (chrome.runtime.lastError) {\r\n          logToBackground(\r\n            \"ERROR\",\r\n            \"[sendPush] Error sending message to background.\",\r\n            { error: chrome.runtime.lastError },\r\n          );\r\n          showStatus(\"Error: Could not send push\", \"error\");\r\n          return;\r\n        }\r\n\r\n        logToBackground(\r\n          \"INFO\",\r\n          \"[sendPush] Received response from background script.\",\r\n          response,\r\n        );\r\n\r\n        if (response.success) {\r\n          clearPushForm();\r\n          showStatus(\"Push sent successfully!\", \"success\");\r\n          chrome.runtime.sendMessage(\r\n            { action: MessageAction.GET_SESSION_DATA },\r\n            (sessionResponse: SessionData) => {\r\n              if (sessionResponse && sessionResponse.recentPushes) {\r\n                displayPushes(sessionResponse.recentPushes);\r\n              }\r\n            },\r\n          );\r\n        } else {\r\n          showStatus(\r\n            `Error: ${response.error || \"Failed to send push\"}`,\r\n            \"error\",\r\n          );\r\n        }\r\n      },\r\n    );\r\n  } catch (error) {\r\n    logToBackground(\"ERROR\", \"[sendPush] An unexpected error occurred.\", {\r\n      error: (error as Error).message,\r\n    });\r\n    showStatus(\r\n      `An unexpected error occurred: ${(error as Error).message}`,\r\n      \"error\",\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Clear push form\r\n */\r\nfunction clearPushForm(): void {\r\n  noteTitleInput.value = \"\";\r\n  noteBodyInput.value = \"\";\r\n  linkTitleInput.value = \"\";\r\n  linkUrlInput.value = \"\";\r\n  linkBodyInput.value = \"\";\r\n  fileInput.value = \"\";\r\n  (document.getElementById(\"file-body\") as HTMLTextAreaElement).value = \"\";\r\n  fileSelected.style.display = \"none\";\r\n}\r\n\r\n/**\r\n * Show status message\r\n */\r\nfunction showStatus(message: string, type: \"success\" | \"error\" | \"info\"): void {\r\n  statusMessage.textContent = message;\r\n  statusMessage.className = type;\r\n\r\n  setTimeout(() => {\r\n    statusMessage.textContent = \"\";\r\n    statusMessage.className = \"\";\r\n  }, 3000);\r\n}\r\n\r\n/**\r\n * Sends a log message to the background script for centralized logging.\r\n * Falls back to console.log if the background script is unreachable.\r\n * @param level The severity level of the log.\r\n * @param message The log message.\r\n * @param data Optional data to include with the log.\r\n */\r\nfunction logToBackground(\r\n  level: \"INFO\" | \"WARN\" | \"ERROR\",\r\n  message: string,\r\n  data?: unknown,\r\n) {\r\n  try {\r\n    chrome.runtime.sendMessage({\r\n      action: \"log\",\r\n      payload: {\r\n        level,\r\n        message,\r\n        data,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    // Fallback to console if background is unavailable\r\n    const fallbackLog = `[FALLBACK] ${message}`;\r\n    if (level === \"ERROR\") {\r\n      console.error(fallbackLog, data, error);\r\n    } else if (level === \"WARN\") {\r\n      console.warn(fallbackLog, data);\r\n    } else {\r\n      // We don't log INFO fallbacks to avoid noise if the background is just waking up.\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Scroll to recent pushes\r\n */\r\nfunction scrollToRecentPushes(): void {\r\n  const recentPushesSection = document.querySelector(\".recent-pushes\");\r\n  if (recentPushesSection) {\r\n    console.log(\"Scrolling to recent pushes section\");\r\n    recentPushesSection.scrollIntoView({\r\n      behavior: \"smooth\",\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update connection indicator\r\n * REMOVED: Connection indicator UI element removed, using badge instead\r\n */\r\n// function updateConnectionIndicator() - REMOVED\r\n\r\n/**\r\n * Listen for messages from background\r\n */\r\nchrome.runtime.onMessage.addListener((message, _, __) => {\r\n  if (message.action === MessageAction.CONNECTION_STATE_CHANGED) {\r\n    // Connection state changes now shown via badge icon only\r\n    console.log(\"Connection state changed:\", message.state);\r\n  } else if (message.action === MessageAction.PUSHES_UPDATED) {\r\n    if (message.pushes) {\r\n      displayPushes(message.pushes as Push[]);\r\n    }\r\n  }\r\n});\r\n\r\n// Export init for testing\r\nexport { init };\r\n\r\n// Initialize on DOM load\r\nif (document.readyState === \"loading\") {\r\n  document.addEventListener(\"DOMContentLoaded\", init);\r\n} else {\r\n  init();\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
